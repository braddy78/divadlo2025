<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Braddyovic Divadelní Sezóna 2025</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
 --bg:#07070b;
 --card:#12121a;
 --border:#242438;
 --cyan:#06f0ff;
 --pink:#ff2bd6;
 --purple:#8b5cf6;
 --text:#e5e7eb;
}
body{
 background:radial-gradient(circle at top,#14143a 0%,#07070b 60%);
 color:var(--text);
 font-family:Inter,Segoe UI,system-ui,sans-serif;
 padding-bottom:80px;
}
.header{
 text-align:center;
 padding:48px 0 32px;
 border-bottom:1px solid var(--border);
}
.header h1{
 font-weight:900;
 letter-spacing:.08em;
 color:white;
 text-shadow:0 0 18px var(--cyan);
}
.subtitle{
 color:#9ca3af;
}
.stat-card{
 background:linear-gradient(180deg,#131322,#0c0c16);
 border:1px solid var(--border);
 border-radius:14px;
 padding:20px;
 height:100%;
 transition:.25s;
 box-shadow:0 0 0 transparent;
}
.stat-card:hover{
 transform:translateY(-4px);
 box-shadow:0 0 25px rgba(6,240,255,.25);
 border-color:var(--cyan);
}
.stat-value{
 font-size:2.4rem;
 font-weight:900;
 color:white;
}
.stat-label{
 font-size:.75rem;
 text-transform:uppercase;
 letter-spacing:.18em;
 color:#9ca3af;
}
.section{
 margin-top:36px;
}
.chart-card{
 background:var(--card);
 border:1px solid var(--border);
 border-radius:14px;
 padding:18px;
 transition:.2s;
}
.chart-card:hover{
 box-shadow:0 0 18px rgba(139,92,246,.25);
}
.chart-title{
 color:var(--cyan);
 font-weight:700;
 font-size:.85rem;
 letter-spacing:.1em;
 text-transform:uppercase;
 margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">
 <h1>BRADDYOVIC DIVADELNÍ SEZÓNA 2025</h1>
 <div class="subtitle">Dramaturgický audit odehraných titulů</div>
</div>

<div class="container section">
 <div class="row g-3">
  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Celkový počet zhlédnutí</div></div></div>
  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statTheatres">0</div><div class="stat-label">Unikátní soubory</div></div></div>
  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statAvg">—</div><div class="stat-label">Průměrné hodnocení</div></div></div>

  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statCities">0</div><div class="stat-label">Navštívená města</div></div></div>
  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statMonth">—</div><div class="stat-label">Nejsilnější měsíc</div></div></div>
  <div class="col-md-4"><div class="stat-card"><div class="stat-value" id="statWeek">—</div><div class="stat-label">Týden na hraně</div></div></div>
 </div>
</div>

<div class="container section">
 <div class="row g-3">
  <div class="col-lg-8">
   <div class="chart-card">
    <div class="chart-title">Měsíční aktivita</div>
    <canvas id="chartMonthly" height="120"></canvas>
   </div>
  </div>
  <div class="col-lg-4">
   <div class="chart-card">
    <div class="chart-title">Distribuce hodnocení</div>
    <canvas id="chartRatings" height="120"></canvas>
   </div>
  </div>
 </div>
</div>

<script>
Chart.defaults.color='#9ca3af';
Chart.defaults.font.family='Inter,Segoe UI,sans-serif';

let shows=[],data=[];

fetch('data/shows.json')
 .then(r=>r.json())
 .then(j=>{
  shows=j.shows||j;
  init();
 });

function parseDate(s){
 const p=s.split('.');
 return new Date(p[2],p[1]-1,p[0]);
}

function init(){
 data=shows.map(s=>{
  const d=parseDate(s.date);
  return {...s,dateObj:d,month:d.getMonth()};
 });

 document.getElementById('statTotal').textContent=data.length;
 document.getElementById('statTheatres').textContent=[...new Set(data.map(d=>d.theatre))].length;
 document.getElementById('statCities').textContent=[...new Set(data.map(d=>d.city))].length;

 const ratings=data.map(d=>+d.rating).filter(n=>!isNaN(n));
 document.getElementById('statAvg').textContent=ratings.length?Math.round(ratings.reduce((a,b)=>a+b)/ratings.length)+' %':'—';

 const byMonth={};
 data.forEach(d=>byMonth[d.month]=(byMonth[d.month]||0)+1);
 const bestM=Object.entries(byMonth).sort((a,b)=>b[1]-a[1])[0];
 document.getElementById('statMonth').textContent=bestM?['Leden','Únor','Březen','Duben','Květen','Červen','Červenec','Srpen','Září','Říjen','Listopad','Prosinec'][bestM[0]]+' • '+bestM[1]:'—';

 const weeks={};
 data.forEach(d=>{
  const m=new Date(d.dateObj);
  m.setDate(m.getDate()-((m.getDay()+6)%7));
  const k=m.toISOString().slice(0,10);
  weeks[k]=(weeks[k]||0)+1;
 });
 const bw=Object.entries(weeks).sort((a,b)=>b[1]-a[1])[0];
 document.getElementById('statWeek').textContent=bw?bw[0]+' • '+bw[1]:'—';

 renderCharts(ratings,byMonth);
}

function renderCharts(ratings,byMonth){
 new Chart(chartMonthly,{
  type:'line',
  data:{labels:Object.keys(byMonth),datasets:[{data:Object.values(byMonth),borderColor:'#06f0ff',tension:.4}]},
  options:{plugins:{legend:{display:false}}}
 });

 const bins=new Array(10).fill(0);
 ratings.forEach(r=>bins[Math.min(9,Math.floor(r/10))]++);
 new Chart(chartRatings,{
  type:'bar',
  data:{labels:['0–9','10–19','20–29','30–39','40–49','50–59','60–69','70–79','80–89','90–100'],datasets:[{data:bins,backgroundColor:'#ff2bd6'}]},
  options:{plugins:{legend:{display:false}}}
 });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
